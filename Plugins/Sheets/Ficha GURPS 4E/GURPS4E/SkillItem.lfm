<?xml version="1.0" encoding="UTF-8"?>
<form name="frmSkillItem" width="365" height="25" margins="{top=5, right=5}">
	<rectangle align="client" color="#404040">

		<layout align="right" width="180">
			<rectangle left="0" top="0" width="30" height="25" color="black" strokeColor="white" strokeSize="1"/>
	        <label left="0" top="3" width="30" height="20" field="nh" horzTextAlign="center"/>

			<comboBox left="30" top="0" width="50" height="25" field="atr" items="{'ST', 'DX', 'IQ', 'HT', 'VT', 'PR', '-'}"/>

			<edit left="85" top="0" width="30" height="25" type="number" field="dx" transparent="true" horzTextAlign="center"/>
			<horzLine left="85" top="22" width="25" strokeColor="white"/>

			<label left="115" top="3" width="5" height="20" text="|" horzTextAlign="center"/>

			<edit left="125" top="3" width="25" height="20" field="pts" horzTextAlign="center" transparent="true"/>
			<horzLine left="125" top="22" width="25" strokeColor="white"/>
			
			<button left="155" top="0" width="25" height="25" text="X">
				<event name="onClick">
					dialogs.confirmOkCancel("Tem certeza que quer apagar esse objeto?",
						function (confirmado)
							if confirmado then
								ndb.deleteNode(sheet);
							end;
					end);
				</event>
			</button>
		</layout>

		<layout align="client">
			<edit align="client" field="nome" transparent="true"/>
			<horzLine align="bottom" strokeColor="white"/>
		</layout>

		<dataLink field="pts">
			<event name="onChange">
				pointCount();
			</event>
		</dataLink>

		<dataLink fields="{'atr', 'dx'}">
			<event name="onChange">
				if sheet==nil then return end;

				local nh = (tonumber(sheet.dx) or 0);

				local mod = 0;
				local node = ndb.getRoot(sheet);
				if sheet.atr=="ST" then
					mod = (tonumber(node.atributos_mod_st) or 0);
				elseif sheet.atr=="DX" then
					mod = (tonumber(node.atributos_mod_dx) or 0);
				elseif sheet.atr=="IQ" then
					mod = (tonumber(node.atributos_mod_iq) or 0);
				elseif sheet.atr=="HT" then
					mod = (tonumber(node.atributos_mod_ht) or 0);
				elseif sheet.atr=="VT" then
					mod = (tonumber(node.atributos_mod_vt) or 0);
				elseif sheet.atr=="PR" then
					mod = (tonumber(node.atributos_mod_per) or 0);
				else
					mod = 0;
				end

				sheet.nh = nh + mod;
			</event>
		</dataLink>
	</rectangle>
</form>
