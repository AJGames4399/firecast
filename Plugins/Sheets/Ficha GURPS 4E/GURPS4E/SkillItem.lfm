<?xml version="1.0" encoding="UTF-8"?>
<form name="frmSkillItem" width="365" height="25" margins="{top=1, right=5}">
	<rectangle align="client" color="#212121">
		<edit left="0" top="0" width="100" height="25" field="nome"/>

		<rectangle left="100" top="0" width="30" height="25" color="black" strokeColor="white" strokeSize="1"/>
        <label left="100" top="3" width="30" height="20" field="nh" horzTextAlign="center"/>

		<comboBox left="130" top="0" width="50" height="25" field="atr" items="{'ST', 'DX', 'IQ', 'HT', 'VT', 'PR', '-'}"/>

		<label left="180" top="3" width="10" height="20" text="+" horzTextAlign="center"/>
		<rectangle left="190" top="0" width="30" height="25" strokeColor="white" color="#FF000000" strokeSize="1" hitTest="false">
			<edit align="client" type="number" field="bonus" transparent="true"/>
		</rectangle>
		<label left="220" top="3" width="10" height="20" text="-" horzTextAlign="center"/>
		<rectangle left="230" top="0" width="30" height="25" strokeColor="white" color="#FF000000" strokeSize="1" hitTest="false">
			<edit align="client" type="number" field="penalidade" transparent="true"/>
		</rectangle>

		<comboBox left="260" top="0" width="55" height="25" field="dificuldade" items="{'F', 'M', 'D', 'MD'}" values="{'F', 'M', 'D', 'MD'}"/>

		<rectangle left="315" top="3" width="25" height="20" strokeColor="white" color="#FF000000" strokeSize="1" hitTest="false">
			<edit align="client" field="pts" horzTextAlign="center" transparent="true"/>
		</rectangle>

		<button left="340" top="0" width="25" height="25" text="X">
			<event name="onClick">
				dialogs.confirmOkCancel("Tem certeza que quer apagar esse objeto?",
					function (confirmado)
						if confirmado then
							ndb.deleteNode(sheet);
						end;
				end);
			</event>
		</button>

		<dataLink field="pts">
			<event name="onChange">
				pointCount();
			</event>
		</dataLink>

		<dataLink fields="{'atr', 'bonus', 'penalidade'}">
			<event name="onChange">
				if sheet==nil then return end;

				local nh = (tonumber(sheet.bonus) or 0) - 
							(tonumber(sheet.penalidade) or 0);

				local mod = 0;
				local node = ndb.getRoot(sheet);
				if sheet.atr=="ST" then
					mod = (tonumber(node.atributos_mod_st) or 0);
				elseif sheet.atr=="DX" then
					mod = (tonumber(node.atributos_mod_dx) or 0);
				elseif sheet.atr=="IQ" then
					mod = (tonumber(node.atributos_mod_iq) or 0);
				elseif sheet.atr=="HT" then
					mod = (tonumber(node.atributos_mod_ht) or 0);
				elseif sheet.atr=="VT" then
					mod = (tonumber(node.atributos_mod_vt) or 0);
				elseif sheet.atr=="PR" then
					mod = (tonumber(node.atributos_mod_per) or 0);
				else
					mod = 0;
				end

				sheet.nh = nh + mod;
			</event>
		</dataLink>
	</rectangle>
</form>
